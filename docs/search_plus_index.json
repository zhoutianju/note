{"./":{"url":"./","title":"简介","keywords":"","body":" last modified by zhoutianju , 2020-10-29 12:43:33 个人笔记 请访问：https://zhoutianju.github.io/note/ Copyright © 2020 zhoutianju.All rights reserved. "},"nginx/Windows-安装-Nginx.html":{"url":"nginx/Windows-安装-Nginx.html","title":"Windows 安装 Nginx","keywords":"","body":" last modified by zhoutianju , 2020-10-29 12:43:14 Windows 安装 Nginx 参考官方说明：http://nginx.org/en/docs/windows.html 下载：http://nginx.org/en/docs/windows.html 说明：由于 Windows 编译环境不太好搭，就别用源码编译了，直接下载 zip 版本即可 安装步骤（本地安装了部分 MSYS2 的命令）： # 解压 unzip nginx-*.zip cd nginx-* # 以下命令需要使用 Windows cmd 环境运行！ # 启动（后台） start nginx # 查看后台进程 tasklist /fi \"imagename eq nginx.exe\" # 其他命令和 Linux 下一致 nginx -s stop # fast shutdown nginx -s quit # graceful shutdown nginx -s reload # changing configuration, starting new worker processes with a new configuration, graceful shutdown of old worker processes nginx -s reopen # re-opening log files 配置开机启动（以 d:\\opt\\nginx-1.16.1 作为安装目录为例），start.bat 文件内容如下： @ECHO OFF REM Start Nginx tasklist /FI \"IMAGENAME eq nginx.exe\" 2>NUL | find /I /N \"nginx.exe\">NUL IF NOT \"%ERRORLEVEL%\"==\"0\" ( REM Nginx is NOT running, so start it d: cd \\opt\\nginx-1.16.1 start nginx.exe ECHO Nginx started. ) else ( ECHO Nginx is already running. ) Windows 创建计划任务（Windows 开始菜单搜索“计划”即可），开机启动，修改了以下配置项 常规 > 不管用户是否登陆都要运行、使用最高权限运行触发器 > 启动时操作 > 启动程序 start.bat Copyright © 2020 zhoutianju.All rights reserved. "},"nginx/静态文件-403-错误.html":{"url":"nginx/静态文件-403-错误.html","title":"静态文件 403 错误","keywords":"","body":" last modified by zhoutianju , 2020-10-29 12:43:31 静态文件 403 错误 问题记录 配置： server { listen 9233; charset utf-8; access_log \"/usr/local/nginx/logs/access.log\"; error_log \"/usr/local/nginx/logs/error.log\"; set $dist_dir \"/root/xxx/dist/\"; # root 权限的目录 location / { alias \"$dist_dir\"; expires -1; } } 浏览器访问报 Nginx 403，error.log 记录如下错误： 2020/04/20 21:09:56 [error] 8374#0: *79668 \"/root/xxx/dist/index.html\" is forbidden (13: Permission denied), client: 10.252.148.50, server: , request: \"GET / HTTP/1.1\", host: \"10.9.15.51:9233\" 2020/04/20 21:09:56 [error] 8374#0: *79668 open() \"/root/xxx/dist/favicon.ico\" failed (13: Permission denied), client: 10.252.148.50, server: , request: \"GET /favicon.ico HTTP/1.1\", host: \"10.9.15.51:9233\", referrer: \"http://10.9.15.51:9233/\" 排查解决 ps -ef | grep nginx 查看 Nginx 启动用户，可以看到 nginx worker 进程是用 nobody 启动的： root 5137 1 0 2019 ? 00:00:00 nginx: master process /usr/local/nginx/nginx nobody 8374 5137 0 21:09 ? 00:00:00 nginx: worker process root 18271 7332 0 21:15 pts/5 00:00:00 grep --color nginx 因此需要将 Nginx 启动用户改为 root（和静态文件目录权限一致），修改 $NGINX_HOME/nginx.conf： # 启动用户，如果不指定则为 nobody user root; # 其他配置... 修改后 nginx -s reload，再查 ps -ef | grep nginx，可以看到新的 nginx worker 已经是用 root 启动的了： root 5137 1 0 2019 ? 00:00:00 nginx: master process /usr/local/nginx/nginx nobody 8374 5137 0 21:09 ? 00:00:00 nginx: worker process is shutting down root 17824 5137 0 21:14 ? 00:00:00 nginx: worker process root 18271 7332 0 21:15 pts/5 00:00:00 grep --color nginx 再次浏览器访问，可以正常访问到静态文件了。 Copyright © 2020 zhoutianju.All rights reserved. "},"nginx/URL-参数改为-path-重定向.html":{"url":"nginx/URL-参数改为-path-重定向.html","title":"URL 参数改为 path 重定向","keywords":"","body":" last modified by zhoutianju , 2020-10-29 12:43:32 URL 参数改为 path 重定向 背景：两套服务，旧的 URL 使用传参方式，新的使用 RESTful 风格，旧服务的域名现在给新服务用了，但之前有人保存了旧服务某些页面的 URL 现在就访问不了了，会默认访问到首页，因此需要兼容旧服务的 URL 风格，重定向到新服务 目标：提取旧 URL 的参数，拼接到新 URL path 中并重定向 例如：http://a.com/user?id=2333 -> http://a.com/user/2333 Nginx 配置如下： server { listen 8080; server_name a.com; # 说明：到这里之前还要经过域名的 Nginx，并且我无法修改，当前是一个下游的 Nginx # 中间省略其他配置 10000 行 # 下面比较重要！！！ # 旧版用户页 URL 重定向到新版用户页 location ^~ /user { # 正则匹配出 URL 参数里的用户 ID，拼接到新版 URL path 中，重定向并把 URL 参数清空 if ($args ~* \"schedulerId=(\\d+)\") { # 正则匹配出一组参数 set $id $1; # 这里必须要自定义一个变量赋值，不能在重定向里直接用 $1，不清楚为啥 # set $args ''; # 重定向后默认带之前的 URL 参数，可以这样把参数置空，也可以用下面的方法 rewrite /user http://a.com/user/$id? redirect; # 这里重定向的 URL 需要写域名，不然默认使用的是 http://a.com:8080/ 的域名，同理也可以重定向到任意其他域名 } } } Copyright © 2020 zhoutianju.All rights reserved. "},"杂项/Kindle-电子书导出-PDF-格式.html":{"url":"杂项/Kindle-电子书导出-PDF-格式.html","title":"Kindle 电子书导出 PDF 格式","keywords":"","body":" last modified by zhoutianju , 2020-10-29 12:43:33 Kindle 电子书导出 PDF 格式 导出方法可参考：https://www.jianshu.com/p/a00a188044b5 解除 DRM 方法可参考：http://www.zhushiyao.com/?p=38356 特别说明：Calibre 5.X 已经升级了 Python3，DeDRM 插件的主分支还没有升级，Github README 中作者也做了说明，目前尚不支持 5.X，但将来会支持，因此需要安装 Calibre 的早期版本，实际安装的是 4.X。 Copyright © 2020 zhoutianju.All rights reserved. "}}